
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Assembling Operators &#8212; The Bempp Book</title>
    
  <link rel="stylesheet" href="../_static/css/index.73d71520a4ca3b99cfee5594769eaaae.css">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="../_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="../_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/sphinx-book-theme.40e2e510f6b7d1648584402491bb10fe.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.3da636dd464baa7582d2.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.d31b09fe5c1d09cb49b26a786de4a05d.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="canonical" href="https://bempp.com/handbook/core/assembling_operators.html" />
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Green’s Representation Theorem" href="../theory/greens_representation.html" />
    <link rel="prev" title="Potential Operators" href="../api/potential_operators.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />


<!-- Opengraph tags -->
<meta property="og:url"         content="https://bempp.com/handbook/core/assembling_operators.html" />
<meta property="og:type"        content="article" />
<meta property="og:title"       content="Assembling Operators" />
<meta property="og:description" content="Assembling Operators  The functionality in bempp.core is almost exclusively for operator assembly and the multiplication of discrete operators and vectors, as t" />
<meta property="og:image"       content="https://bempp.com/handbook/_static/logo.png" />

<meta name="twitter:card" content="summary" />


  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../index.html">
  
  <img src="../_static/logo.png" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">The Bempp Book</h1>
  
</a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../intro.html">
   Introduction
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  API Overview
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../api/grids.html">
   Grids
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../api/function_spaces.html">
   Function Spaces
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../api/grid_functions.html">
   Grid Functions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../api/boundary_operators.html">
   Boundary Operators
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../api/solvers.html">
   Linear Solvers
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../api/potential_operators.html">
   Potential Operators
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  A dive into the Bempp core routines
 </span>
</p>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Assembling Operators
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Mathematical background of boundary integral equations
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../theory/greens_representation.html">
   Green’s Representation Theorem
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../theory/function_spaces.html">
   Function Spaces for scalar problems
  </a>
 </li>
</ul>

</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/core/assembling_operators.md"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.md</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

        <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        
        <a class="issues-button"
            href="https://github.com/bempp/bempp-book/issues/new?title=Issue%20on%20page%20%2Fcore/assembling_operators.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        <a class="edit-button" href="https://github.com/bempp/bempp-book/edit/master/core/assembling_operators.md"><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Edit this page"><i class="fas fa-pencil-alt"></i>suggest edit</button></a>
    </div>
</div>


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#assembly-options">
   Assembly options
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#assembling-operators-using-numba">
   Assembling Operators using Numba
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#assembling-operators-using-opencl">
   Assembling Operators using OpenCL
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#assembling-on-different-devices">
     Assembling on different devices
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#assembling-operators-using-fmm">
   Assembling Operators using FMM
  </a>
 </li>
</ul>

        </nav>
        
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="assembling-operators">
<h1>Assembling Operators<a class="headerlink" href="#assembling-operators" title="Permalink to this headline">¶</a></h1>
<p>The functionality in <code class="docutils literal notranslate"><span class="pre">bempp.core</span></code> is almost exclusively for operator assembly and the multiplication
of discrete operators and vectors, as these is the most computationally-heavy components of BEM.</p>
<p>Bempp uses just-in-time compiled <a class="reference external" href="#assembling-operators-using-opencl">OpenCL</a> or
<a class="reference external" href="#assembling-operators-using-numba">Numba</a>
kernels to quickly assemble the dense matrices that arise from discretising BEM operators.</p>
<p>For larger problems, however, the use of dense matrices is expensive, both in terms of computation
time and storage space. For such problems, Bempp can use the <a class="reference external" href="#assembling-operators-using-fmm">fast multipole method</a>
to speed up matrix assembly and the computation of matrix-vector products. This is done via
interfaces to the external <a class="reference external" href="https://github.com/exafmm/exafmm-t">ExaFMM</a> library.</p>
<div class="section" id="assembly-options">
<h2>Assembly options<a class="headerlink" href="#assembly-options" title="Permalink to this headline">¶</a></h2>
<p>The type of assembly used by Bempp can be controlled by passing a <code class="docutils literal notranslate"><span class="pre">device_interface</span></code> keyword
argument into an operator. The possible values that can be passed in are <code class="docutils literal notranslate"><span class="pre">&quot;opencl&quot;</span></code>,
<code class="docutils literal notranslate"><span class="pre">&quot;numba&quot;</span></code>. FMM can be used by passing <code class="docutils literal notranslate"><span class="pre">assembler=&quot;fmm&quot;</span></code> into an operator. Examples of how this can
be done are given in the <a class="reference internal" href="../api/boundary_operators.html"><span class="doc std std-doc">boundary operators</span></a> section of the API
Overview.</p>
</div>
<div class="section" id="assembling-operators-using-numba">
<h2>Assembling Operators using Numba<a class="headerlink" href="#assembling-operators-using-numba" title="Permalink to this headline">¶</a></h2>
<p>On some systems (for example recents versions of MacOS), OpenCL is not available or has some features
unavailable. If this is the case, Bempp can use <a class="reference external" href="https://numba.pydata.org/">Numba</a>
to just-in-time compile operator assembly routines.</p>
<p>Bempp’s Numba kernels are defined in the file <a class="reference external" href="https://github.com/bempp/bempp-cl/blob/master/bempp/core/numba_kernels.py"><code class="docutils literal notranslate"><span class="pre">bempp/core/numba_kernels.py</span></code></a>.
Bempp can use Numba
to just-in-time compile operator assembly routines.</p>
</div>
<div class="section" id="assembling-operators-using-opencl">
<h2>Assembling Operators using OpenCL<a class="headerlink" href="#assembling-operators-using-opencl" title="Permalink to this headline">¶</a></h2>
<p>OpenCL is a C-based compute language designed to allow a single script to be parallelised on
a wide range of CPU and GPU devices. Bempp uses <a class="reference external" href="https://documen.tician.de/pyopencl/">PyOpenCL</a>
to just-in-time compile its OpenCL kernels when they are needed.</p>
<p>Bempp’s OpenCL kernels are stored in the folder <a class="reference external" href="https://github.com/bempp/bempp-cl/tree/master/bempp/core/sources/kernels"><code class="docutils literal notranslate"><span class="pre">bempp/core/sources/kernels</span></code></a>.</p>
<div class="section" id="assembling-on-different-devices">
<h3>Assembling on different devices<a class="headerlink" href="#assembling-on-different-devices" title="Permalink to this headline">¶</a></h3>
<p>OpenCL can be used to assemble operators on a wide range of GPU and CPU devices. You can view
your available devices by running:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">bempp.core</span> <span class="kn">import</span> <span class="n">opencl_kernels</span>
<span class="n">opencl_kernels</span><span class="o">.</span><span class="n">show_available_platforms_and_devices</span><span class="p">()</span>
</pre></div>
</div>
<p>Each available device will be displayed alongside their platform and device indices. These
indices can be used to set the default device. For example, the following snippet will set the
default device to be the 0th device on platform 1:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">opencl_kernels</span><span class="o">.</span><span class="n">set_default_device</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<p>The default device can be viewed by running:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">opencl_kernels</span><span class="o">.</span><span class="n">default_device</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="assembling-operators-using-fmm">
<h2>Assembling Operators using FMM<a class="headerlink" href="#assembling-operators-using-fmm" title="Permalink to this headline">¶</a></h2>
<p>For larger problems, dense assembly using OpenCL or Numba become very expensive, both in terms of
computation time and memory consumption. In such cases, Bempp can use the fast multipole method (FMM)
to speed up its calculations and reduce memory usage.</p>
<p>Internally, Bempp uses the <a class="reference external" href="https://github.com/exafmm/exatmm-t">ExaFMM</a> library to carry out its FMM computations.</p>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./core"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        
    <a class='left-prev' id="prev-link" href="../api/potential_operators.html" title="previous page">Potential Operators</a>
    <a class='right-next' id="next-link" href="../theory/greens_representation.html" title="next page">Green’s Representation Theorem</a>

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Timo Betcke and Matthew Scroggs<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="../_static/js/index.3da636dd464baa7582d2.js"></script>


    
  </body>
</html>